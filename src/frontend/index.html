<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåü Forest Adventure - Practice Talking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Base for 3D effect on cards */
        .interactive-scene {
            perspective: 1000px;
        }

        /* Subtle 3D lift on hover */
        .card-3d-lift {
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
            transform: translateZ(0);
            /* Ensure element is on its own layer for 3D */
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .card-3d-lift:hover {
            transform: translateZ(20px) scale(1.02);
            box-shadow: 0 20px 30px rgba(0, 0, 0, 0.25);
        }

        /* Interactive Button Base for sensory feedback */
        .interactive-button {
            transition: all 0.1s ease;
            transform: translateZ(0);
        }

        .interactive-button:hover {
            transform: translateZ(5px);
            box-shadow: 0 5px 0px rgba(0, 0, 0, 0.1);
        }

        .interactive-button:active {
            transform: translateZ(0) translateY(2px);
            /* Provides a clear 'press' feeling */
            box-shadow: 0 0px 0px rgba(0, 0, 0, 0.1);
        }

        /* Floating and Wiggling Animations */
        @keyframes float {

            0%,
            100% {
                transform: translateY(0px) translateZ(0);
            }

            50% {
                transform: translateY(-8px) translateZ(5px);
            }
        }

        @keyframes wiggle {

            0%,
            100% {
                transform: rotate(-2deg);
            }

            50% {
                transform: rotate(2deg);
            }
        }

        .float-animation {
            animation: float 3.5s ease-in-out infinite;
        }

        .wiggle-animation {
            animation: wiggle 2s ease-in-out infinite;
        }

        /* Background */
        body {
            background: linear-gradient(to bottom, #c6f6d5 0%, #68d391 100%);
            /* Lighter, friendlier green */
            background-attachment: fixed;
            font-family: 'Arial', sans-serif;
            /* Clearer font choice */
        }

        .forest-card {
            background: rgba(255, 255, 255, 0.98);
            /* Near-white for high contrast */
            backdrop-filter: blur(8px);
        }

        .message-user {
            background: linear-gradient(135deg, #63b3ed 0%, #4299e1 100%);
            /* Clear, solid color */
            border-color: #3182ce;
        }

        .message-assistant {
            background: linear-gradient(135deg, #f6e05e 0%, #f6ad55 100%);
            /* Warm, friendly color */
            border-color: #dd6b20;
        }
    </style>
</head>

<body class="min-h-screen">
    <div id="app" class="max-w-6xl mx-auto p-4 relative z-10 interactive-scene">

        <div class="forest-card rounded-[3rem] shadow-2xl p-6 mb-6 border-6 border-green-500 card-3d-lift">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-4">
                    <span class="text-6xl wiggle-animation">üåà</span>
                    <div>
                        <h1 class="text-4xl font-extrabold text-green-700">Forest Adventure</h1>
                        <p class="text-green-600 text-xl font-medium">Practice Talking is Fun!</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <div
                        class="bg-orange-100 rounded-full px-5 py-2 flex items-center gap-2 border-3 border-orange-400 shadow-md">
                        <span class="text-3xl">üî•</span>
                        <span class="font-extrabold text-orange-700 text-xl"><span id="streak">0</span> Days!</span>
                    </div>
                    <button onclick="toggleBadges()"
                        class="bg-yellow-100 rounded-full px-5 py-2 flex items-center gap-2 interactive-button border-3 border-yellow-400 shadow-md">
                        <span class="text-3xl">üèÜ</span>
                        <span class="font-extrabold text-yellow-700 text-xl"><span id="badgeCount">0</span>
                            Badges</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="flex gap-6 flex-wrap lg:flex-nowrap">
            <div
                class="w-full lg:w-96 forest-card rounded-[3rem] shadow-2xl p-8 border-6 border-green-500 card-3d-lift">
                <h3 class="text-3xl font-bold text-green-700 mb-6 flex items-center gap-2">
                    <span class="text-4xl float-animation">üå≤</span> Your Growth Path
                </h3>

                <div class="space-y-6" id="progressBars">
                </div>

                <div class="mt-10 pt-6 border-t-4 border-green-300">
                    <h4 class="font-bold text-green-700 text-2xl mb-5 flex items-center gap-2">
                        <span class="text-3xl">üß©</span> Fun Activities
                    </h4>
                    <div class="space-y-4">
                        <button onclick="startExercise('greetings')"
                            class="w-full bg-gradient-to-r from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600 text-white py-5 rounded-3xl font-extrabold text-xl shadow-lg border-4 border-blue-700 interactive-button">
                            <span class="text-3xl">üêª</span> Say Hello
                        </button>
                        <button onclick="startExercise('emotions')"
                            class="w-full bg-gradient-to-r from-purple-400 to-purple-500 hover:from-purple-500 hover:to-purple-600 text-white py-5 rounded-3xl font-extrabold text-xl shadow-lg border-4 border-purple-700 interactive-button">
                            <span class="text-3xl">ü¶ã</span> Talk About Feelings
                        </button>
                        <button onclick="startExercise('questions')"
                            class="w-full bg-gradient-to-r from-teal-400 to-teal-500 hover:from-teal-500 hover:to-teal-600 text-white py-5 rounded-3xl font-extrabold text-xl shadow-lg border-4 border-teal-700 interactive-button">
                            <span class="text-3xl">ü¶â</span> Ask Questions
                        </button>
                        <button onclick="startExercise('sharing')"
                            class="w-full bg-gradient-to-r from-pink-400 to-pink-500 hover:from-pink-500 hover:to-pink-600 text-white py-5 rounded-3xl font-extrabold text-xl shadow-lg border-4 border-pink-700 interactive-button">
                            <span class="text-3xl">üê∞</span> Share Stories
                        </button>
                    </div>
                </div>

            </div>

            <div class="flex-1 forest-card rounded-[3rem] shadow-2xl flex flex-col border-6 border-green-500 card-3d-lift"
                style="height: calc(100vh - 120px);">
                <div id="messages" class="flex-1 overflow-y-auto p-8 space-y-6">
                </div>

                <div class="border-t-4 border-green-300 p-6 bg-green-50 rounded-b-[3rem]">
                    <div class="flex gap-4">
                        <input type="text" id="messageInput" placeholder="Type a friendly message here..."
                            class="flex-1 px-6 py-5 border-4 border-blue-400 rounded-full focus:border-blue-600 focus:outline-none text-xl bg-white shadow-inner font-medium"
                            onkeypress="handleKeyPress(event)" />
                        <button onclick="sendMessage()" id="sendButton"
                            class="bg-gradient-to-r from-green-500 to-green-700 hover:from-green-600 hover:to-green-800 text-white px-8 py-5 rounded-full font-extrabold text-xl flex items-center gap-3 shadow-xl border-4 border-green-800 interactive-button">
                            <span class="text-3xl">üí¨</span>
                            <span>Talk!</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="badgeModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
        <div
            class="forest-card rounded-[4rem] p-16 text-center max-w-lg border-10 border-yellow-500 shadow-2xl float-animation interactive-scene">
            <div class="text-9xl mb-6 wiggle-animation" style="transform: translateZ(30px);">ü•≥</div>
            <h2 class="text-5xl font-extrabold text-green-700 mb-4">Amazing Job!</h2>
            <p class="text-2xl font-semibold text-gray-700 mb-2">You earned a new badge:</p>
            <p id="newBadgeText" class="text-7xl font-black text-yellow-600 mb-10"
                style="text-shadow: 4px 4px 0 #fcd34d;"></p>
            <button onclick="closeBadgeModal()"
                class="bg-gradient-to-r from-green-500 to-green-700 hover:from-green-600 hover:to-green-800 text-white px-12 py-5 rounded-full font-extrabold text-2xl shadow-xl interactive-button border-4 border-green-800">
                Hooray! üåü
            </button>
        </div>
    </div>

    <script>
        // State
        let sessionId = 'session-' + Date.now();
        let setupComplete = false;
        let progress = { greetings: 5, emotions: 2, questions: 7, sharing: 0 }; // Example starting data
        let badges = ["Hello Explorer üêª"];
        let streak = 3;

        // API base URL
        const API_BASE = window.location.origin;

        // Initialize
        window.onload = function () {
            addMessage('assistant', "Hello there! I'm your playful friend ü¶ä. Let's start a fun talking adventure. What's your name?");
            updateProgress();
            updateBadges();
            document.getElementById('streak').textContent = streak;
        };

        // ... (rest of the sendMessage, handleKeyPress, startExercise functions remain the same) ...

        // --- Core Functions (Simplified/Adapted for new design) ---

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            if (!message) return;

            addMessage('user', message);
            input.value = '';

            const loadingId = addLoadingMessage();

            // Simulate API call and state update
            await new Promise(r => setTimeout(r, 1500)); // Simulate network delay
            removeLoadingMessage(loadingId);

            // SIMULATED RESPONSE LOGIC
            let responseText = "That's a great thing to share! Tell me more about it.";
            let newBadgesEarned = [];

            // Simple simulated progress update
            if (message.toLowerCase().includes('hello') || message.toLowerCase().includes('hi')) {
                progress.greetings = Math.min(10, progress.greetings + 1);
                if (progress.greetings === 10 && !badges.includes("Hello Master üêª")) {
                    badges.push("Hello Master üêª");
                    newBadgesEarned.push("Hello Master üêª");
                }
            } else if (message.toLowerCase().includes('happy') || message.toLowerCase().includes('sad')) {
                progress.emotions = Math.min(10, progress.emotions + 1);
            }

            if (newBadgesEarned.length > 0) {
                updateBadges();
                updateProgress();
                showBadgeModal(newBadgesEarned[0]);
            } else {
                updateProgress();
            }

            addMessage('assistant', responseText);
        }

        function addMessage(role, content) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;

            const emoji = role === 'user' ? 'üòä' : 'ü¶ä';
            const bgColor = role === 'user'
                ? 'message-user text-white'
                : 'message-assistant text-gray-800 border-4 border-yellow-700';

            messageDiv.innerHTML = `
                <div class="max-w-xl">
                    <div class="flex items-start gap-3 ${role === 'user' ? 'flex-row-reverse' : ''}">
                        <span class="text-4xl ${role === 'assistant' ? 'float-animation' : ''}">${emoji}</span>
                        <div class="${bgColor} px-6 py-4 rounded-3xl shadow-xl font-medium border-2 ${role === 'user' ? 'border-blue-700' : ''}">
                            <p class="text-xl leading-relaxed">${content}</p>
                        </div>
                    </div>
                </div>
            `;

            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function addLoadingMessage() {
            const messagesDiv = document.getElementById('messages');
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loading-' + Date.now();
            loadingDiv.className = 'flex justify-start';
            loadingDiv.innerHTML = `
                <div class="flex items-start gap-3">
                    <span class="text-4xl float-animation">ü¶ä</span>
                    <div class="bg-gradient-to-r from-green-100 to-green-200 px-6 py-4 rounded-3xl shadow-lg border-4 border-green-300">
                        <div class="flex gap-2">
                            <div class="w-4 h-4 bg-green-500 rounded-full animate-bounce"></div>
                            <div class="w-4 h-4 bg-green-500 rounded-full animate-bounce" style="animation-delay: 0.2s;"></div>
                            <div class="w-4 h-4 bg-green-500 rounded-full animate-bounce" style="animation-delay: 0.4s;"></div>
                        </div>
                    </div>
                </div>
            `;
            messagesDiv.appendChild(loadingDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            return loadingDiv.id;
        }

        function removeLoadingMessage(id) {
            const loading = document.getElementById(id);
            if (loading) loading.remove();
        }

        function updateProgress() {
            const progressBars = document.getElementById('progressBars');
            progressBars.innerHTML = `
                ${createProgressBar('Hello Bear üêª', progress.greetings, 10, 'blue')}
                ${createProgressBar('Feeling Butterfly ü¶ã', progress.emotions, 10, 'purple')}
                ${createProgressBar('Question Owl ü¶â', progress.questions, 10, 'teal')}
                ${createProgressBar('Story Bunny üê∞', progress.sharing, 10, 'pink')}
            `;
        }

        function createProgressBar(label, value, max, color) {
            const percentage = Math.min((value / max) * 100, 100);
            const colors = {
                blue: 'from-blue-400 to-blue-600',
                purple: 'from-purple-400 to-purple-600',
                teal: 'from-teal-400 to-teal-600',
                pink: 'from-pink-400 to-pink-600'
            };

            return `
                <div>
                    <div class="flex justify-between mb-2">
                        <span class="text-lg font-bold text-green-800">${label}</span>
                        <span class="text-lg font-extrabold text-green-900">${value}/${max}</span>
                    </div>
                    <div class="w-full bg-green-200 rounded-full h-6 border-4 border-green-400 overflow-hidden shadow-inner">
                        <div class="bg-gradient-to-r ${colors[color]} h-full rounded-full transition-all duration-500 shadow-xl" style="width: ${percentage}%"></div>
                    </div>
                </div>
            `;
        }

        function updateBadges() {
            const badgesList = document.getElementById('badgesList');
            const badgeCount = document.getElementById('badgeCount');

            badgeCount.textContent = badges.length;

            // Removed badgesList display from this area to simplify sidebar visually
        }

        function showBadgeModal(badge) {
            document.getElementById('newBadgeText').textContent = badge;
            document.getElementById('badgeModal').classList.remove('hidden');
        }

        function closeBadgeModal() {
            document.getElementById('badgeModal').classList.add('hidden');
        }

        function toggleBadges() {
            // Simplified badge view for a pop-up
            alert('üèÜ Your Adventure Badges:\n\n' + (badges.length ? badges.map(b => '‚≠ê ' + b).join('\n') : 'Keep practicing to collect forest badges!'));
        }

        async function startExercise(type) {
            const exercises = {
                greetings: "Let's practice saying hello! üêª I'll start: Hello! How are you today? Remember to use a happy voice!",
                emotions: "Let's talk about feelings! ü¶ã Can you tell me about a time you felt really happy? Use your words!",
                questions: "Let's practice asking questions! ü¶â I'll tell you about my forest, and you can ask me anything! Try asking 'Why' or 'What'!",
                sharing: "Let's practice sharing! üê∞ Tell me about something you really like, like your favorite toy or food!"
            };

            addMessage('assistant', exercises[type]);
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
    </script>
</body>

</html>